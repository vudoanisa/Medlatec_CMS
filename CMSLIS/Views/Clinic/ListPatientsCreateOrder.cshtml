@model  CMS_Core.Models.PatientAddViewModel
@using CMS_Core.Entity;

@{
    ViewBag.Title = "Đăng ký khám bệnh";
    CMS_Core.Common.ComboBoxFinal<ClassComboBox> ComboBox = new CMS_Core.Common.ComboBoxFinal<ClassComboBox>();
    var UserInfo = ((cms_Account)Session["UserInfo"]);
    float TotalPay = 0;
}

<script src="/Content/AdminLTE/js/Customer/jquery.masknumber.js"></script>
<script src="/Content/AdminLTE/js/Customer/ListPatientsCreateOrder.js"></script>
<!-- Head Libs -->
<script src="/Content/AdminLTE/vendor/modernizr/modernizr.js"></script>

<script src="/Content/assets/js/jquery.maskedinput.js"></script>
<script src="/Content/assets/js/jquery.masknumber.js"></script>

<script type="text/javascript">
    $(function () {
        $("#sothe").mask("aa-9-99 999-999-9999");

    });
</script>

<!-- Begin Content -->
<div class="box box-info">
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    @using (Html.BeginForm("ListPatientsCreateOrder", "Clinic", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { role = "form", @class = "form-horizontal" }))
    {
        <!-- Main content -->
        <section class="content">
            <div class="col-md-12">

                <ul class="widget-header nav nav-tabs nav-fill" role="tablist">
                    <li class="nav-item active">
                        <a class="nav-link" id="just-tab-1" data-toggle="tab" href="#j-tab-1" role="tab" aria-controls="j-tab-1" aria-selected="true"><i class="fa fa-heart"></i> Thông tin bệnh nhân</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="just-tab-3" data-toggle="tab" href="#j-tab-3" role="tab" aria-controls="j-tab-3" aria-selected="false"><i class="fa fa-h-square"></i> Tiền sử bệnh</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="just-tab-2" data-toggle="tab" href="#j-tab-2" role="tab" aria-controls="j-tab-2" aria-selected="false"> <i class="fa fa-warning"></i> Dị ứng</a>
                    </li>
                    @if (Model.PATIENTINFO.PID != 0)
                    {
                        <li class="nav-item">
                            <a class="nav-link" id="just-tab-4" data-toggle="tab" href="#j-tab-4" role="tab" aria-controls="j-tab-4" aria-selected="false"><i class="fa fa-calendar-plus-o "></i> Lịch sử khám</a>
                        </li>
                    }
                </ul>



                @Html.AntiForgeryToken()

                <div class="tab-content" style="min-height: 500px;">



                    <div class="tab-pane active" id="j-tab-1" role="tabpanel" aria-labelledby="base-tab-1">


                        <div class="col-12 ml-auto" style="margin-top: -10px;margin-bottom: -5px;">
                            <div class="section-title mt-3 mb-3">
                                <h4 class="text-bold">1. Thông tin bệnh nhân</h4>
                            </div>
                        </div>

                        <div class="form-group row">

                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label class="control-label col-xs-4 " style="font-weight:bold;  ">Mã BN:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.PID, new { @class = "form-control", type = "SingleLine", placeholder = "Mã BN", autocomplete = "false" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Họ tên:<span class="required">*</span></label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.PATIENTNAME, new { @class = "form-control", type = "SingleLine", placeholder = "Họ tên", autocomplete = "true", id = "PATIENTNAME" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Ngày Sinh:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.BIRTHDAYVIEW, new { @class = "form-control", id = "date", name = "date" })
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Giới tính:</label>
                                    <div class="col-xs-4">
                                        @Html.DropDownListFor(m => m.PATIENTINFO.SEX, ComboBox.GetComboBoxBySelected("SELECT   category_name  as idfield,    category_desc as namefield FROM  dm_gioitinh where categorys_status = 2", "idfield", "namefield", Model.PATIENTINFO.SEX.ToString(), false), new { @class = "form-control select2", onchange = "SelectedValueSEX(this)" })
                                    </div>
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Cân nặng:</label>
                                    <div class="col-xs-4">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.weight, new { @class = "form-control", type = "number", placeholder = "Cân nặng", autocomplete = "false", id = "weight" })
                                    </div>
                                </div>
                            </div>



                        </div>
                        <div class="form-group row">

                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Tuổi:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.AGE, new { @class = "form-control", type = "number", placeholder = "Tuổi" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Tỉnh:</label>
                                    <div class="col-xs-9">
                                        @Html.DropDownListFor(m => m.PATIENTINFO.CITY, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    category_desc as namefield FROM  DM_TINHTHANH where categorys_status = 2", "idfield", "namefield", Model.PATIENTINFO.CITY.ToString(), false), new { @class = "form-control select2", onchange = "SelectedValueTinh(this)" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Huyện:</label>
                                    <div class="col-xs-8">
                                        @Html.DropDownListFor(m => m.PATIENTINFO.DISTRICT, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    category_desc as namefield FROM  DM_QUANHUYEN where categorys_status = 2 and tinhthanh_id =   " + Model.PATIENTINFO.CITY, "idfield", "namefield", Model.PATIENTINFO.DISTRICT.ToString(), true), new { @class = "form-control select2", ID = "huyen", name = "Huyen", onchange = "SelectedValuehuyen(this)" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Địa chỉ:</label>
                                    <div class="col-xs-10">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.ADDRESS, new { @class = "form-control", type = "SingleLine", placeholder = "Địa chỉ", autocomplete = "true" })
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="form-group row">

                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Mobile:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.PHONE, new { @class = "form-control", type = "number", placeholder = "Di động" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Email:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.EMAILADDRESS, new { @class = "form-control", type = "email", placeholder = "Email", autocomplete = "true" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-7">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Thông tin phụ huynh:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.PARENTS_INFO, new { @class = "form-control", type = "SingleLine", placeholder = "Đối với trẻ dưới 72 tháng tuổi", autocomplete = "true" })
                                    </div>
                                </div>
                            </div>




                        </div>

                        <div class="form-group row">

                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Số CMT:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.IDENTIFICATION, new { @class = "form-control", type = "SingleLine", placeholder = "Số chứng minh thư", autocomplete = "true" })

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Ngày cấp:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.IDENTIFICATION_DATEVIEW, new { @class = "form-control", id = "dateCMT", name = "dateCMT", autocomplete = "true" })

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Nơi cấp:</label>
                                    <div class="col-xs-8">
                                        @Html.TextBoxFor(m => m.PATIENTINFO.IDENTIFICATION_ISSUED, new { @class = "form-control", type = "SingleLine", placeholder = "Nơi cấp", autocomplete = "true" })
                                    </div>
                                </div>
                            </div>

                        </div>




                        <div class="col-12 ml-auto" style=" margin-bottom: -5px;">
                            <div class="section-title mt-3 mb-3">
                                <h4 class="text-bold">2. Thông tin dịch vụ</h4>
                            </div>
                        </div>

                        <div class="form-group row">


                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Đối tượng:<span class="required">*</span></label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.SID, new { @class = "checkbox-inline", Type = "hidden" })

                                        @Html.DropDownListFor(m => m.PATIENT.OBJECTID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    category_desc as namefield FROM  DM_DOITUONG where categorys_status = 2", "idfield", "namefield", Model.PATIENT.OBJECTID.ToString(), true), new { @class = "form-control select2", onchange = "SelectedValueOBJECTID(this)", id = "OBJECTID" })

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Phân loại KH:<span class="required">*</span></label>
                                    <div class="col-xs-8">
                                        @Html.DropDownListFor(m => m.PATIENT.TYPECUSTOMERID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    category_desc as namefield FROM  DM_PHANLOAIKHACHHANG where categorys_status = 2 order by CATEGORY_ORDER asc", "idfield", "namefield", Model.PATIENT.TYPECUSTOMERID.ToString(), true), new { @class = "form-control select2", onchange = "SelectedValueTYPECUSTOMERID(this)", id = "TYPECUSTOMERID" })
                                    </div>
                                </div>
                            </div>

                            @*<div class="col-sm-3">
                <div class="form-group">
                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Khoa khám:<span class="required">*</span></label>
                    <div class="col-xs-8">
                        @Html.DropDownListFor(m => m.PATIENT.DEPARTMENTSID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    DEPARTMENT_NAME as namefield FROM  CMS_DEPARTMENT where DEPARTMENT_STATUS = 2 and PARTNERID = " + UserInfo.PARTNERID + "  order by DEPARTMENT_NAME asc", "idfield", "namefield", Model.PATIENT.DEPARTMENTSID.ToString(), true), new { @class = "form-control select2", onchange = "SelectedValueKhoaKham(this)", id = "DEPARTMENTSID" })
                    </div>
                </div>
            </div>*@

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Phòng khám:<span class="required">*</span></label>
                                    <div class="col-xs-10">
                                        @Html.ListBoxFor(m => m.PATIENT.LISTLOCATIONID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    ROOM_NAME as namefield FROM  CMS_ROOM_CLINIC where STATUS = 2 and PARTNERID = " + UserInfo.PARTNERID + "  order by ROOM_NAME asc", "idfield", "namefield", Model.PATIENT.LISTLOCATIONID, true), new { @class = "form-control select2 SERVICEID", multiple = "multiple", id = "phong" })

                                        @*@Html.DropDownListFor(m => m.PATIENT.LOCATIONID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    ROOM_NAME as namefield FROM  CMS_ROOM_CLINIC where STATUS = 2 and PARTNERID = " + UserInfo.PARTNERID + " and DEPARTMENT_ID = " + Model.PATIENT.DEPARTMENTSID + "  order by ROOM_NAME asc", "idfield", "namefield", Model.PATIENT.LOCATIONID.ToString(), true), new { @class = "form-control select2", onchange = "SelectedValueDEPARTMENTSID(this)", ID = "phong", name = "phong" })*@
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Lý do khám:<span class="required">*</span></label>
                                    <div class="col-xs-10">
                                        @Html.TextBoxFor(m => m.PATIENT.REASON, new { @class = "form-control", type = "text", placeholder = "Lý do khám", autocomplete = "true", id = "REASON" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-xs-2" style="font-weight:bold;  ">Ghi chú:</label>
                                    <div class="col-xs-10">
                                        @Html.TextBoxFor(m => m.PATIENT.GHICHU, new { @class = "form-control", type = "text", placeholder = "Ghi chú", autocomplete = "true", id = "GHICHU" })

                                    </div>
                                </div>
                            </div>


                        </div>



                        <div class="form-group row">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Gói dịch vụ:</label>
                                    <div class="col-xs-8">
                                        @Html.DropDownListFor(m => m.PATIENT.SERVICE_GROUPID, ComboBox.GetComboBoxBySelected("select id as idfield, service_group_name as namefield from CMS_SERVICE_GROUP where service_group_status = 2 and  (PARTNERID = " + UserInfo.PARTNERID + " or PARTNERID = 0)  order by service_group_name asc", "idfield", "namefield", Model.PATIENT.SERVICE_GROUPID.ToString(), true), new { @class = "form-control select2", onchange = "SelectedValueChoGoi(this)", id = "SERVICE_GROUPID" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-4" style="font-weight:bold;  ">Lần khám:</label>
                                    <div class="col-xs-8">
                                        @Html.DropDownListFor(m => m.PATIENT.VISIT_PATIENT_ID, ComboBox.GetComboBoxBySelected("SELECT   id  as idfield,    name as namefield FROM  CMS_VISIT_PATIENT where STATUS = 2", "idfield", "namefield", Model.PATIENT.VISIT_PATIENT_ID.ToString(), false), new { @class = "form-control select2", ID = "Visit_ID" })
                                       
                                    </div>
                                </div>
                            </div>


                        </div>

                        <div class="form-group row">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="control-label col-xs-1" style="font-weight:bold;  ">Dịch vụ:</label>
                                    <div class="col-xs-11">
                                        @Html.ListBoxFor(m => m.PATIENT.mulSERVICEID, ComboBox.GetComboBoxBySelected("select id as idfield, SERVICE_NAME as namefield from CMS_SERVICE where SERVICE_STATUS = 2 and  (PARTNERID = " + UserInfo.PARTNERID + " or PARTNERID = 0)  order by SERVICE_NAME asc", "idfield", "namefield", Model.PATIENT.mulSERVICEID, true), new { @class = "form-control select2 SERVICEID", multiple = "multiple", onchange = "SelectedValueChoService(this)", id = "SERVICEID" })

                                    </div>
                                </div>
                            </div>





                        </div>

                        <div class="col-12 ml-auto" style=" margin-bottom: -5px;">
                            <div class="section-title mt-3 mb-3">
                                <h4 class="text-bold">3. Dịch vụ đã chọn</h4>
                            </div>
                        </div>



                        <div class="form-group row">
                            <table id="sorting-table" class="table table-bordered table-striped dataTable" role="grid" style="height:90px;">
                                <thead>
                                    <tr>
                                        <th id="SERVICE_NAME">Tên dịch vụ</th>
                                        <th id="SERVICE_CODE">Mã dịch vụ</th>
                                        <th id="SERVICE_UNIT">Đơn vị</th>
                                        <th class="text-right" id="SERVICE_PRICE">Giá tiền</th>

                                        <th id="SERVICE_RETURN_DATE">Lần khám</th>
                                        <th id="Status">Trạng thái</th>
                                    </tr>
                                </thead>
                                <tbody id="sorting-table-body">
                                    @if (Model.SERVICES != null)
                                    {
                                        var indexService = 0;
                                        foreach (var data in Model.SERVICES)
                                        {
                                            <tr>
                                                <td>@data.SERVICE_NAME</td>
                                                <td>@data.SERVICE_CODE</td>
                                                <td>@data.UnitName</td>
                                                <td class="text-right">@CMSLIS.Common.Common.FmtAmt(data.SERVICE_PRICE)</td>

                                                <td>@data.VISIT_PATIENT_NAME</td>
                                                @if (data.is_pay == 0)
                                                {
                                                    <td>
                                                        Chưa thanh toán

                                                        <span style="display:none;">  @(TotalPay = TotalPay + Convert.ToInt64(data.SERVICE_PRICE)) </span>

                                                    </td>

                                                }
                                                else

                                                {
                                                    <td>Đã thanh toán</td>
                                                }


                                                <td style="display:none;" class="SERVICE_ID">@data.ID</td>

                                            </tr>


                                        }
                                    }

                                </tbody>



                            </table>

                        </div>

                        <div class="col-12 ml-auto " style=" margin-bottom: -5px;">
                            <div class="section-title mt-3 mb-3">
                                <h4 class="text-bold">4. Thông tin thanh toán</h4>
                            </div>
                        </div>

                        <div class="form-group row">

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Tổng tiền:</label>
                                    <div class="col-xs-9">

                                        <span style="display:none;">
                                            @if (Model.PATIENT.SERVICE_GROUPID == 0)
                                            {
                                            @(Model.PATIENT.SUMMONEY = TotalPay)
                                            @(Model.PATIENT.SUMMONEYPAY = TotalPay)
                                            }
                                        </span>
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEY_VIEW, new { @class = "form-control text-right", type = "text", placeholder = "Tổng tiền", autocomplete = "true", id = "TotalPrice", disabled = "True" })
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEY, new { @class = "checkbox-inline", Type = "hidden", id = "TotalPrice1" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Ưu đãi:</label>
                                    <div class="col-xs-9">
                                        @Html.DropDownListFor(m => m.PATIENT.DISCOUNT, ComboBox.GetComboBoxBySelected("SELECT   category_name  as idfield,    category_desc as namefield FROM  DM_UUDAI where categorys_status = 2 order by CATEGORY_ORDER asc", "idfield", "namefield", Model.PATIENT.DISCOUNT.ToString(), true), new { @class = "form-control select2", id = "ddlUudai", onchange = "SelectedValueUudai(this)" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Tiền giảm:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEYDISCOUNT, new { @class = "form-control text-right", type = "text", placeholder = "Tiền giảm", autocomplete = "true", id = "TotalDiscount", disabled = "True" })
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEYDISCOUNT, new { @class = "checkbox-inline", Type = "hidden", id = "TotalDiscount" })

                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Phải TT:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEYPAY, new { @class = "form-control text-right", type = "text", placeholder = "Tiền thanh toán", autocomplete = "true", id = "TotalPay", disabled = "True" })
                                        @Html.TextBoxFor(m => m.PATIENT.SUMMONEYPAY, new { @class = "checkbox-inline", Type = "hidden", id = "TotalPay1" })

                                    </div>
                                </div>
                            </div>





                        </div>

                        <div class="form-group row">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Tiền mặt:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.SPOTCASH_VIEW, new { @class = "form-control text-right", type = "text", placeholder = "Tiền mặt", autocomplete = "true", id = "SPOTCASH" })
                                        @Html.TextBoxFor(m => m.PATIENT.SPOTCASH, new { @class = "checkbox-inline", Type = "hidden", id = "SPOTCASH1" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Thẻ POS:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.MONEYPOS_VIEW, new { @class = "form-control text-right", type = "text", placeholder = "Thẻ POS", autocomplete = "true" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Khách đưa:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.MONEYGIVE_VIEW, new { @class = "form-control text-right", type = "text", placeholder = "Khách đưa", autocomplete = "true", id = "MONEYGIVE" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label class="control-label col-xs-3" style="font-weight:bold;  ">Thừa:</label>
                                    <div class="col-xs-9">
                                        @Html.TextBoxFor(m => m.PATIENT.MONEYREFUNDS, new { @class = "form-control text-right", type = "text", placeholder = "Thừa", autocomplete = "true", id = "MONEYREFUNDS", disabled = "True" })
                                        @Html.TextBoxFor(m => m.PATIENT.MONEYREFUNDS, new { @class = "checkbox-inline", Type = "hidden", id = "MONEYREFUNDS1" })
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane" id="j-tab-2" role="tabpanel" aria-labelledby="base-tab-2">

                        <div class="widget has-shadow" style="margin-top: 0px;">
                            <div class="widget-body">
                                <div class="form-group row  ">
                                    <div class="col-lg-4">
                                        @Html.TextBoxFor(m => m.ALLERGGY.ALLERGY_NAME, new { @class = "form-control  ", type = "SingleLine", placeholder = "Tên dị ứng", autocomplete = "true", id = "ALLERGY_NAME" })
                                    </div>
                                    <label class="col-lg-1 form-control-label text-bold text-right">Loại DU</label>
                                    <div class="col-lg-2">
                                        @Html.DropDownListFor(m => m.ALLERGGY.ALLERGY_TYPE, ComboBox.GetComboBoxBySelected("SELECT id as idfield,  CATEGORY_DESC as namefield  FROM  DM_LOAIDIUNG  where categorys_status = 2", "idfield", "namefield", Model.ALLERGGY.ALLERGY_TYPE.ToString(), true), new { @class = "form-control select2", id = "ALLERGY_TYPE", onchange = "SelectedValueALLERGY_TYPE(this)" })
                                    </div>
                                    <div class="col-lg-3">
                                        @Html.TextBoxFor(m => m.ALLERGGY.ALLERGY_NOTE, new { @class = "form-control  ", type = "SingleLine", placeholder = "Ghi chú", autocomplete = "true", id = "ALLERGY_NOTE" })

                                    </div>
                                    <button type="button" class="btn btn-danger mr-1 mb-2" style="width:100px;" id="SaveALLERGGYID" onclick="return SaveALLERGGY();"><i class="fa fa-save"></i>  Lưu </button>

                                </div>
                                @Html.TextBoxFor(m => m.ALLERGGY.ID, new { @class = "checkbox-inline", Type = "hidden" })
                            </div>
                        </div>

                        <!-- Sorting -->
                        <div class="widget has-shadow">
                            <div class="widget-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped dataTable" role="grid" id="table-sick">
                                        <thead>
                                            <tr>
                                                <th id="ALLERGY_NAME">Tên dị ứng</th>
                                                <th id="ALLERGY_TYPE">Loại dị ưng</th>
                                                <th id="ALLERGY_NOTE">Ghi chú</th>
                                                <th id="edit">Edit</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sorting-table-sick">
                                            @if (Model.ALLERGGYS != null)
                                            {
                                                foreach (var data in Model.ALLERGGYS)
                                                {
                                                    <tr>
                                                        <td class="ALLERGY_NAME">@data.ALLERGY_NAME</td>
                                                        <td>@data.ALLERGY_TYPE_NAME</td>
                                                        <td style="display:none;" class="ALLERGY_TYPE">@data.ALLERGY_TYPE</td>
                                                        <td style="display:none;" class="ALLERGY_ID">@data.ID</td>
                                                        <td class="ALLERGY_NOTE">@data.ALLERGY_NOTE</td>
                                                        <td class='td-actions'>  <a class="Update" href="javascript:;"><i class="fa fa-edit edit"></i></a> </td>
                                                    </tr>
                                                }
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- End Sorting -->



                    </div>

                    <div class="tab-pane" id="j-tab-3" role="tabpanel" aria-labelledby="base-tab-3">

                        <div class="widget has-shadow" style="margin-top: 0px;">
                            <div class="widget-body">
                                <div class="form-group row  ">

                                    @*<label class="col-lg-2 form-control-label text-bold text-right">Tên bệnh</label>*@
                                    <div class="col-lg-3">
                                        @Html.DropDownListFor(m => m.HISTORIE.SICKNAME, ComboBox.GetComboBoxBySelected("SELECT id as idfield,  SICK_NAME as namefield  FROM   CMS_SICK where SICK_STATUS = 2", "namefield", "namefield", Model.HISTORIE.SICKNAME.ToString(), true), new { @class = "form-control select2", id = "SICKNAME", onchange = "SelectedValueSICKNAME(this)" })
                                    </div>
                                    <label class="col-lg-1 form-control-label text-bold text-right">Năm</label>
                                    <div class="col-lg-2">
                                        @Html.TextBoxFor(m => m.HISTORIE.SICKYEAR, new { @class = "form-control  ", type = "number", placeholder = "Năm", autocomplete = "true", id = "SICKYEAR" })
                                    </div>
                                    @*<label class="col-lg-1 form-control-label text-bold text-right">Ghi chú</label>*@
                                    <div class="col-lg-4">
                                        @Html.TextBoxFor(m => m.HISTORIE.NOTE, new { @class = "form-control  ", type = "SingleLine", placeholder = "Ghi chú", autocomplete = "true", id = "HISTORIENOTE" })
                                    </div>
                                    <button type="button" class="btn btn-danger mr-1 mb-2" style="width:100px;" id="SaveHISTORIEID" onclick="return SaveHISTORIE();"><i class="fa fa-save"></i> Lưu </button>

                                </div>
                                @Html.TextBoxFor(m => m.HISTORIE.ID, new { @class = "checkbox-inline", Type = "hidden" })
                            </div>
                        </div>

                        <!-- Sorting -->
                        <div class="widget has-shadow">
                            <div class="widget-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped dataTable" role="grid" id="table_history">
                                        <thead>
                                            <tr>
                                                <th id="SICKNAME">Tên bệnh</th>
                                                <th id="SICKYEAR">Năm</th>
                                                <th id="HISTORIENOTE">Ghi chú</th>
                                                <th id="edit">Edit</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sorting-table-history">
                                            @if (Model.HISTORIES != null)
                                            {
                                                foreach (var data in Model.HISTORIES)
                                                {
                                                    <tr>
                                                        <td class="SICKNAME">@data.SICKNAME</td>
                                                        <td class="SICKYEAR">@data.SICKYEAR</td>
                                                        <td class="HISTORIES_NOTE">@data.NOTE</td>
                                                        <td style="display:none;" class="HISTORIES_ID">@data.ID</td>
                                                        <td class='td-actions'>  <a class="Update" href="javascript:;"><i class="fa fa-edit edit"></i></a></td>
                                                    </tr>
                                                }
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- End Sorting -->



                    </div>


                    @if (Model.PATIENTINFO.PID != 0)
                    {
                        <div class="tab-pane" id="j-tab-4" role="tabpanel" aria-labelledby="base-tab-4">
                            <!-- Sorting -->
                            <div class="widget has-shadow">
                                <div class="widget-body">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped dataTable" role="grid" id="table_history">
                                            <thead>
                                                <tr>
                                                    <th id="DATEIN">Ngày khám</th>
                                                    <th id="REASON">Lý do khám</th>
                                                    <th id="DEPARTMENTSID">Khoa khám</th>
                                                    <th id="GHICHU">Ghi chú</th>
                                                    <th id="SID">Xem bệnh</th>
                                                </tr>
                                            </thead>
                                            <tbody id="sorting-table-history">
                                                @if (Model.PATIENTS != null)
                                                {
                                                    foreach (var data in Model.PATIENTS)
                                                    {
                                                        <tr>
                                                            <td>@CMSLIS.Common.Common.ReFmtTime(data.DATEIN)</td>
                                                            <td><span>@data.REASON</span></td>
                                                            <td>@data.DEPARTMENT_NAME</td>
                                                            <td>@data.GHICHU</td>
                                                            <td>
                                                                <a href="/Clinic/medicalExaminationResult?sid=@data.SID&pid=@data.PID&Token=@CMSLIS.Common.Common.generalKeyPrivate(data.SID.ToString(),data.PID.ToString())" target="_blank" id="Edit"><i class="fa fa-eye"></i></a>
                                                            </td>
                                                        </tr>
                                                    }
                                                }

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- End Sorting -->

                        </div>
                    }



                </div>


                @Html.TextBoxFor(m => m.PATIENTINFO.PID, new { @class = "checkbox-inline", Type = "hidden" })
                @Html.TextBoxFor(m => m.PATIENTINFO.PARTNERID, new { @class = "checkbox-inline", Type = "hidden" })
                @Html.TextBoxFor(m => m.PATIENTINFO.partnerid_Code, new { @class = "checkbox-inline", Type = "hidden" })

                <div class="em-separator separator-dashed"></div>
                <div class="text-right" style="margin-top: 10px;">
                    <button type="submit" name="submit" value="hiddent" id="hiddent" class="btn btn-danger" style="display: none;"></button>

                    @if (Model.PATIENT.SID != 0 && Model.PATIENTINFO.PID != 0)
                    {
                        <a id="PATIENT_PRESCRIPTIONS" href="/Clinic/ListPatientPrint?sid=@Model.PATIENT.SID&pid=@Model.PATIENTINFO.PID&Token=@CMSLIS.Common.Common.generalKeyPrivate(@Model.PATIENT.SID.ToString(),@Model.PATIENTINFO.PID.ToString())" class="btn btn-primary" target="_blank"><i class="fa fa-backward"></i> In Hóa đơn (F9)  </a>
                    }
                    <button type="submit" name="submit" id="SaveListPatientsCreateOrder" value="SaveListPatientsCreateOrder" class="btn btn-danger"><i class="fa fa-save"></i> Lưu (Alt + S)</button>
                    <a id="BackListPatients" href="/Clinic/ListPatients" class="btn btn-primary"><i class="fa fa-backward"></i>  Quay lại (Alt + Z)</a>

                </div>

            </div>
        </section>
    }
</div>
<!-- end Content -->

<script src="/content/AdminLTE/vendor/nanoscroller/nanoscroller.js"></script>

<script src="/content/AdminLTE/vendor/magnific-popup/magnific-popup.js"></script>
<script src="/content/AdminLTE/vendor/jquery-placeholder/jquery.placeholder.js"></script>


<!-- Specific Page Vendor -->
<script src="/Content/AdminLTE/vendor/select2/select2.js"></script>
<!-- InputMask -->
<script src="/Content/AdminLTE/vendor/input-mask/jquery.inputmask.js"></script>
<script src="/Content/AdminLTE/vendor/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="/Content/AdminLTE/vendor/input-mask/jquery.inputmask.extensions.js"></script>

<script src="/Content/AdminLTE/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

<script src="/Content/AdminLTE/vendor/jquery-datatables/media/js/jquery.dataTables.js"></script>
<script src="/Content/AdminLTE/vendor/jquery-datatables/extras/TableTools/js/dataTables.tableTools.min.js"></script>
<script src="/Content/AdminLTE/vendor/jquery-datatables-bs3/assets/js/datatables.js"></script>

<!-- Theme Base, Components and Settings -->
<script src="/Content/AdminLTE/javascripts/theme.js"></script>

<!-- Theme Custom -->
<script src="/Content/AdminLTE/javascripts/theme.custom.js"></script>

<!-- Theme Initialization Files -->
<script src="/Content/AdminLTE/javascripts/theme.init.js"></script>
